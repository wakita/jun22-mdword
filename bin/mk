#!/bin/sh

PATH=$HOME/.cabal/bin:$PATH
step=$1
step=${step:=v0}

case $step in
  v0) # いきなりテキストファイルを処理
    parameters=(
    -f markdown
    doc/constitution.txt);;

  v1) # Markdown化
    parameters=(
    -f markdown
    doc/constitution.md);;

  v2) # 目次の追加
    parameters=(
    -f markdown+pandoc_title_block
    --number-sections
    --filter=pandoc-crossref
    --metadata="corssrefYaml:etc/pandoc-crossref-ja.yaml"
    --table-of-contents
    doc/constitution.md);;
    
  # スタイリング
  v3)
    parameters=(
    -f markdown+pandoc_title_block
    --number-sections
    --metadata="corssrefYaml:etc/pandoc-empty.yaml"
    --reference-docx=etc/constitution.docx
    --table-of-contents
    doc/constitution.md);;

  final) # 完成
    parameters=(
    -f markdown+pandoc_title_block
    --number-sections
    --filter=pandoc-crossref
    --metadata="corssrefYaml:etc/pandoc-crossref-ja.yaml"
    --reference-docx=etc/constitution.docx
    --table-of-contents
    doc/constitution.md);;
esac

cmdline="pandoc -t docx -o constitution-$step.docx --standalone ${parameters[@]}"
echo $cmdline
$cmdline
